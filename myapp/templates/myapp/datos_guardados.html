<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <title>Datos Guardados</title>
        <script>
            function multiplicarValores() {
                var shapingRate = {{ shaping_rate }};
                var puertosLag = {{ datos.puertos_lag }};
                var resultado = shapingRate * puertosLag;
                var bw_plus_por = {{bw_plus_por}}
                document.getElementById("resultado").innerText = "El resultado es: " + resultado;
            }

            function generarTxt() {
                var textAreaContent = document.getElementById("dataTextArea").value;
                var blob = new Blob([textAreaContent], { type: "text/plain;charset=utf-8" });
                var link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = "datos.txt";
                link.click();
            }
        </script>
        {% load static %}  <!-- Cargar la etiqueta static -->
        <link rel="stylesheet" href="{% static 'myapp/styles.css' %}">
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Lato:wght@700&display=swap" rel="stylesheet">
    </head>
    <body>
        <div class="container">
            <header>
                <h1 class="titulo">Datos Guardados</h1>
                <p>El valor de num_puertos_lag es: {{ form.lag.value }}</p>
            </header>
            <main>
                <a href="http://deliveryconsole/pdetailsearch.asp" target="_blank">Ir a Delivery Console</a><br>
                <a href="http://ximelat/" target="_blank">Ir a Xime Metro2</a><br>
                <a href="http://4.74.133.173:8080/logon.aspx" target="_blank">Ir a Xime Metro3</a><br>
                <a href="http://xicpe/select.aspx" target="_blank">Ir a CRUD xicpe</a><br>
                <a href="https://myworkspace.ctlaccess.centurylink.com" target="_blank">Ir a Level3</a><br>
                <a href="https://netbox-cirex.ciriontechnologies.com/login/?next=/extras/changelog/" target="_blank">Ir a netbox</a><br>
                <a href="https://mxtoolbox.com/SuperTool.aspx?action=blacklist%3a204.199.94.42&run=toolpage" target="_blank">Ir a blacklist2</a><br>
                <a href="https://www.spamrats.com/index.php" target="_blank">Ir a blacklist1</a><br>
                <a href="http://searchnodeslat.lat.intranet/" target="_blank">Ir a CLLI</a><br>
                <a href="http://127.0.0.1:8000/pais_mercado_nodo/" target="_blank">Ir a P2P</a><br>
                <a href="https://rap.ciriontechnologies.com/Citrix/StoreWeb/#/home" target=_blank">Ir a Citrix Cirion</a><br>

                {% load network_filters %}
                <div class="copy-box">
                    <button class="datos-button" onclick="generateAllTxt()" aria-label="Generar Todos los TXT">Generar Todos los TXT</button>

                    <div class="title">Datos del Cliente</div>
                    <textarea id="dataTextArea" class="datos-textarea" readonly>
                        {% if datos.cfs %}CFS: {{ datos.cfs }}{% endif %}
                        {% if datos.dko %}DKO: {{ datos.dko }}{% endif %}
                        {% if datos.tipo_configuracion %}tipo_configuracion: {{ datos.tipo_configuracion }}{% endif %}
                        {% if datos.tipo_servicio %}tipo_servicio: {{ datos.tipo_servicio }}{% endif %}
                        {% if datos.rfs_ip_port %}RFS-IP-PORT: {{ datos.rfs_ip_port }}{% endif %}
                        {% if datos.rfs_ip_port_nid %}RFS-IP-PORT_NID: {{ datos.rfs_ip_port_nid }}{% endif %}
                        {% if datos.cliente %}Cliente: {{ datos.cliente }}{% endif %}
                        {% if datos.sede %}SEDE: {{ datos.sede }}{% endif %}
                        {% if datos.sw %}SW: {{ datos.sw }}{% endif %}
                        {% if datos.interface_sw %}Interface SW: {{ datos.interface_sw }}{% endif %}
                        {% if datos.pe %}PE: {{ datos.pe }}{% endif %}
                        {% if datos.unit %}Interface PE: {{ datos.interface_pe }}.{{ datos.unit }}{% endif %}
                        {% if datos.unit_nid and datos.unit_nid != "" %}Interface NID: {{ datos.interface_pe }}.{{ datos.unit_nid }}{% endif %}
                        {% if datos.sv and  datos.tipo_equipo == 'ALCATEL' %}Interface PE: {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}{% endif %}
                        {% if datos.vrf %}VRF: {{ datos.vrf }}{% endif %}
                        {% if datos.vt %}Vlan Tercero: {{ datos.vt }}{% endif %}
                        {% if datos.rd %}RD: {{ datos.rd }}{% endif %}
                        {% if datos.sv %}SV: {{ datos.sv }}{% endif %}
                        {% if datos.cv %}CV: {{ datos.cv }}{% endif %}
                        {% if datos.bw and datos.bw != '0' %}BW: {{ datos.bw }}M{% endif %}
                        {% if datos.wan and datos.wan != '0.0.0.0/0' %}WAN: {{ datos.wan }}{% endif %}
                        {% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}WANIPv6: {{ datos.wanv6 }}{% endif %}
                        {% if datos.lan and datos.lan != '0.0.0.0/0' %}LANIPv4: {{ datos.lan }}{% endif %}
                        {% if datos.lanv6 %}LANIPv6: {{ datos.lanv6 }}{% endif %}
                        {% if datos.asn %}ASN: {{ datos.asn }}{% endif %}
                        {% if datos.lbcpe %}LB CPE: {{ datos.lbcpe }}{% endif %} 
                        {% if datos.lnnid %}LB NID: {{ datos.lnnid }}{% endif %}                      
                        {% if datos.rfs_ip_port_b %}RFS-IP-PORT_B: {{ datos.rfs_ip_port_b }}{% endif %}
                        {% if datos.sede_b %}SEDE_B: {{ datos.sede_b }}{% endif %}
                        {% if datos.sw_b %}SW_B: {{ datos.sw_b }}{% endif %}
                        {% if datos.interface_sw_b %}Interface SW_B: {{ datos.interface_sw_b }}{% endif %}
                        {% if datos.pe_b %}PE_B: {{ datos.pe_b }}{% endif %}
                        {% if datos.interface_pe_b %}Interface PE_B: {{ datos.interface_pe_b }}.{{datos.unit_b }}{% endif %}
                        {% if datos.sv_b %}SV_B: {{ datos.sv_b }}{% endif %}
                        {% if datos.cv_b %}CV_B: {{ datos.cv_b }}{% endif %}
                    </textarea>
                    <div class="button-container">
                        <button class="datos-button" onclick="copyToClipboard('dataTextArea')" aria-label="Copiar Datos">Copiar Datos</button>
                        <button class="datos-button" onclick="generarTxt()" aria-label="Generar TXT">Generar TXT</button>
                    
                    </div>
                </div>

                <div class="copy-box">                
                    <div class="title">Comandos Previos</div>
                    <textarea id="commandsTextArea" class="datos-textarea" readonly>
                        {% if datos.tipo_configuracion == "Modificacion" or datos.tipo_configuracion == "Ampliacion" and datos.tipo_servicio == "VPLS" %}
                bash
                roci {{ datos.pe }}
                configure private
                
                show interfaces {{ datos.interface_pe }}.{{ datos.unit }} | display set | no
                show | display set | match {{ datos.interface_pe }}.{{ datos.unit }} | no-more 
                
                {% if datos.pe_b %} #####{% endif %}
                bash
                roci {{ datos.pe_b }}
                configure private
                
                show interfaces {{ datos.interface_pe_b }}.{{ datos.unit_b }} | display set | no
                show | display set | match {{ datos.interface_pe_b }}.{{ datos.unit_b }} | no-more 
                
                {% elif datos.tipo_configuracion == "Alta" and datos.tipo_servicio == "VPLS" and datos.tipo_equipo == "JUNIPER" %}
                bash
                roci {{ datos.pe }}
                configure private
                
                show interfaces {{ datos.interface_pe }}.{{ datos.unit }} | display set | no
                
                {% if datos.rfs_ip_port_b %}{% endif %}
                
                bash
                roci {{ datos.pe_b }}
                configure private
                
                show interfaces {{ datos.interface_pe_b }}.{{ datos.unit_b }} | display set | no
                
                {% elif datos.tipo_configuracion == "Ampliacion" and datos.tipo_servicio == "VPN" and datos.tipo_equipo == "JUNIPER" %}
                bash
                roci {{ datos.pe }}
                configure private
                
                show interfaces {{ datos.interface_pe }}.{{ datos.unit }} | display set | no
                show | display set | match  {{ datos.interface_pe }}.{{ datos.unit }}- | no
                
                {% elif datos.tipo_configuracion == "Ampliacion" and datos.tipo_servicio == "ADI" and datos.tipo_equipo == "JUNIPER" %}
                bash
                roci {{ datos.pe }}
                configure private
                
                show interfaces {{ datos.interface_pe }}.{{ datos.unit }} | display set | no
                show | display set | match  {{ datos.interface_pe }}.{{ datos.unit }} | no
                
                {% elif datos.tipo_configuracion == "Ampliacion" and datos.tipo_servicio == "ADI" and datos.tipo_equipo == "ALCATEL" %}
                bash
                roci {{ datos.pe }}
                
                {% elif datos.tipo_configuracion == "Alta" and datos.tipo_servicio == "ADI" and datos.tipo_equipo == "JUNIPER" %}
                bash
                roci {{ datos.pe }}
                configure private
                {% if datos.rfs_ip_port_nid  %}show  interfaces  {{ datos.interface_pe }}  | display set  | no-more{% endif %}
                {% if datos.rfs_ip_port %}show  interfaces  {{ datos.interface_pe }}.{{ datos.unit }}  | display set  | no-more{% endif %}
                run show route  {{ datos.wan|first_valid_ip }} | no-more
                
                {% for lan_ip in lan_ips %}
                    {% if datos.lan != '0.0.0.0/0' %}run show route   {{ lan_ip }} | no-more {% endif %}
                {% endfor %}
                
                {% elif datos.tipo_configuracion == "Alta" and datos.tipo_servicio == "ADI" and datos.tipo_equipo == "ALCATEL" %}
                bash
                roci {{ datos.pe }}
                
                configure lag {{num_puertos_lag}}
                info
                exit
                admin display-config | match {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }} context all
                admin display-config | match {{ datos.IES }} context all
                
                show qos sap-ingress | match CUSTOMER-{{ qos }}
                show router route-table    {{ datos.wan|first_valid_ip }}
                configure qos sap-ingress xxx
                info
                exit
                
                {% elif datos.tipo_configuracion == "Alta" and datos.tipo_servicio == "ADI" and datos.tipo_equipo == "ALCATEL_V" %}
                bash
                {% if datos.pe == "irs1.ccs1" %}ssh EA-CO11455@10.85.132.40{% endif %}
                
                admin show configuration configure full-context | match  {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}
                admin show configuration configure full-context | match  :{{ datos.sv }}
                admin show configuration configure full-context | match   {{ datos.IES }}
                
                admin show configuration configure full-context | match  CUSTOMER-{{ qos }}
                show router route-table    {{ datos.wan|first_valid_ip }}
                {% for lan_ip in lan_ips %}
                show router route-table    {{ lan_ip|first_valid_ip }}
                ##
                {% endfor %}

                admin show configuration configure full-context | match queue | match sap-ingress | match xxx
                
                {% elif datos.tipo_configuracion == "Alta" and datos.tipo_servicio == "VPN" and datos.tipo_equipo == "JUNIPER" %}
                bash
                roci {{ datos.pe }}
                configure private
                
                show  routing-instances {{ datos.vrf }}  | display set | match vrf  | no
                show interfaces {{ datos.interface_pe }}.{{ datos.unit }} | display set | no
                show | display set | match  {{ datos.interface_pe }}.{{ datos.unit }} | no
                show  | display set | match {{ datos.rd }}
                run show route table  {{ datos.vrf }}  {{ datos.wan|first_valid_ip }}
                
                {% else %}
                ###No se cumple ninguna condición para Comandos.
                {% endif %}
                    </textarea>
                    <div class="button-container">
                        <button class="datos-button" onclick="copyToClipboard('commandsTextArea')" aria-label="Copiar Comandos">Copiar Comandos</button>
                        <button class="datos-button" onclick="generateTxtFile()" aria-label="Generar TXT">Generar</button>
                    </div>
                </div>
                
                <script>
                function copyToClipboard(elementId) {
                    var copyText = document.getElementById(elementId);
                    copyText.select();
                    document.execCommand("copy");
                }
                
                function generateTxtFile() {
                    var textAreaContent = document.getElementById('commandsTextArea').value;
                    var lines = textAreaContent.split('\n');
                    var trimmedLines = lines.map(line => line.trimStart());
                    var trimmedContent = trimmedLines.join('\n');
                    var blob = new Blob([trimmedContent], { type: "text/plain;charset=utf-8" });
                    var link = document.createElement("a");
                    link.href = URL.createObjectURL(blob);
                    link.download = "commands.txt";
                    link.click();
                }
                </script>
                
                
                <div class="copy-box">
                    <div class="title">Configuración de la Interfaz</div>
                    <textarea id="newCommandsTextArea" class="datos-textarea" readonly>

                        


                        {% if datos.tipo_configuracion == "Modificacion" or datos.tipo_configuracion == "Ampliacion" and datos.tipo_servicio == "VPLS" and datos.tipo_equipo == "JUNIPER" %}

                            #PE {{ datos.pe }}
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} description "CUSTOMER: {{ datos.cliente }} (CFS:{{ datos.cfs }}) (RFS:{{ datos.rfs_ip_port }})"
                            
                            {% if datos.pe_b %} #####{% endif %}

                            #PE {{ datos.pe_b }}
                            set interfaces {{ datos.interface_pe_b }} unit {{ datos.unit_b }} description "CUSTOMER: {{ datos.cliente }} (CFS:{{ datos.cfs }}) (RFS:{{ datos.rfs_ip_port_b }})"

                            


                            {% elif datos.tipo_configuracion == "Alta" and datos.tipo_servicio == "VPLS" and datos.tipo_equipo == "JUNIPER" %}

                            PE {{ datos.pe }}
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} description "CUSTOMER:{{ datos.cliente }} (CFS:{{ datos.cfs }}) (RFS:{{ datos.rfs_ip_port }})"
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} encapsulation vlan-vpls
                            {% if datos.sv == datos.cv %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} vlan-id {{ datos.sv }} {% endif %}
                            {% if datos.sv != datos.cv %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} vlan-tags outer 0x8100.{{ datos.sv }} inner 0x8100.{{ datos.cv }}{% endif %}
                            {% if datos.sv == datos.cv %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} input-vlan-map pop {% endif %}
                            {% if datos.sv != datos.cv %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} input-vlan-map pop-pop{% endif %}
                            {% if datos.sv == datos.cv %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} output-vlan-map push {% endif %}
                            {% if datos.sv != datos.cv %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} output-vlan-map push-push{% endif %}
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family vpls filter input {{ datos.interface_pe }}.{{ datos.unit }}-cos-i
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family vpls filter output {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family vpls policer input {{ datos.interface_pe }}.{{ datos.unit }}-cir-in
                            
                            {% if datos.pe_b %} #####{% endif %}

                            PE {{ datos.pe_b }}
                            set interfaces {{ datos.interface_pe_b }} unit {{ datos.unit_b }} description "CUSTOMER:{{ datos.cliente }}(CFS:{{ datos.cfs }})(RFS:{{ datos.rfs_ip_port_b }})"
                            set interfaces {{ datos.interface_pe_b }} unit {{ datos.unit_b }} encapsulation vlan-vpls
                            {% if datos.sv_b == datos.cv_b %}set interfaces {{ datos.interface_pe_b }} unit {{ datos.unit_b }} vlan-id {{ datos.sv_b }} {% endif %}
                            {% if datos.sv_b != datos.cv_b %}set interfaces {{ datos.interface_pe_b }} unit {{ datos.unit_b }} vlan-tags outer 0x8100.{{ datos.sv_b }} inner 0x8100.{{ datos.cv_b }}{% endif %}
                            {% if datos.sv_b == datos.cv_b %}set interfaces {{ datos.interface_pe_b }} unit {{ datos.unit_b }} input-vlan-map pop {% endif %}
                            {% if datos.sv_b != datos.cv_b %}set interfaces {{ datos.interface_pe_b }} unit {{ datos.unit_b }} input-vlan-map pop-pop{% endif %}
                            {% if datos.sv_b == datos.cv_b %}set interfaces {{ datos.interface_pe_b }} unit {{ datos.unit_b }} output-vlan-map push {% endif %}
                            {% if datos.sv_b != datos.cv_b %}set interfaces {{ datos.interface_pe_b }} unit {{ datos.unit_b }} output-vlan-map push-push{% endif %}
                            set interfaces {{ datos.interface_pe_b }} unit {{ datos.unit_b }} family vpls filter input {{ datos.interface_pe_b }}.{{ datos.unit_b }}-cos-i
                            set interfaces {{ datos.interface_pe_b }} unit {{ datos.unit_b }} family vpls filter output {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e
                            set interfaces {{ datos.interface_pe_b }} unit {{ datos.unit_b }} family vpls policer input {{ datos.interface_pe_b }}.{{ datos.unit_b }}-cir-in

                            

                        {% elif datos.tipo_configuracion == "Ampliacion" and datos.tipo_servicio == "VPN" and datos.tipo_equipo == "JUNIPER" %}

                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} description "CUSTOMER: {{ datos.cliente }}(CFS:{{ datos.cfs }})(RFS:{{ datos.rfs_ip_port }})"

                            
                        
                            {% elif datos.tipo_configuracion == "Ampliacion" and datos.tipo_servicio == "ADI" and datos.tipo_equipo == "JUNIPER" %}

                        {% load custom_filters %}

                        {% if "edge" in datos.pe|strip %}

                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet policer input ratelimit-{{  bwjun }}
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet policer output ratelimit-{{  bwjun }}
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet6 policer input ratelimit-{{  bwjun }}-IPV6
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet6 policer output ratelimit-{{  bwjun }}-IPV6
                        {% else %}
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} description "CUSTOMER:{{ datos.cliente }}(CFS:{{ datos.cfs }})(RFS:{{ datos.rfs_ip_port }})"
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} bandwidth {{ bwjun }}
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} vlan-tags outer 0x8100.{{ datos.sv }} inner 0x8100.{{ datos.cv }}
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet rpf-check mode loose
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet mtu 1500
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet no-redirects
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet filter input NETPROTECT-BE
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet policer input CUSTOMER-{{  datos.bw }}M
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet policer output CUSTOMER-{{  datos.bw }}M
                        {% endif %}
                        
                        

                        

                        {% elif datos.tipo_configuracion == "Ampliacion" and datos.tipo_servicio == "ADI" and datos.tipo_equipo == "ALCATEL" %}

                            admin display-config | match {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }} context all
                            configure lag {{ datos.lag }}
                            info
                            exit
                            show qos sap-ingress | match CUSTOMER-{{ datos.bw }}
                            configure qos sap-ingress xxx
                            info
                            exit
                            configure service ies xxx
                            interface {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}
                            description "CUSTOMER:{{ datos.cliente }}(CFS:{{ datos.cfs }})(RFS:{{ datos.rfs_ip_port }}"
                            sap xxxx
                            ingress qos xxx
                            egress agg-rate rate  {{ bw_lag_alcatel }}
                            exit all

                            admin display-config | match {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }} context all

                            
                        
                        {% elif datos.tipo_configuracion == "Alta" and datos.tipo_servicio == "VPN" and datos.tipo_equipo == "JUNIPER" %}

                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} description "CUSTOMER: {{ datos.cliente }} (CFS:{{ datos.cfs }})(RFS:{{ datos.rfs_ip_port }})"
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} vlan-tags outer 0x8100.{{ datos.sv }} inner 0x8100.{{ datos.cv }}
                            {% if "-1-" in datos.vrf|strip %}
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet no-redirects
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet policer output {{ datos.interface_pe }}.{{ datos.unit }}-out

                            {% else %}
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet mtu 1500
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet filter output {{ datos.interface_pe }}.{{ datos.unit }}-inet-e

                            {% endif %}
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet filter input {{ datos.interface_pe }}.{{ datos.unit }}-inet-i
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet policer input {{ datos.interface_pe }}.{{ datos.unit }}-in
                            {% if datos.wan|first_valid_ip_with_mask and datos.wan|first_valid_ip_with_mask != '0.0.0.1/0'%}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet address {{ datos.wan|first_valid_ip_with_mask }}{% endif %}

                            

                        {% elif datos.tipo_configuracion == "Alta" and datos.tipo_servicio == "ADI" and datos.tipo_equipo == "JUNIPER" %}
                                
                            {% if "edge" in datos.pe|strip %}

                                {% if datos.rfs_ip_port_nid  %}
                                    set interfaces {{ datos.interface_pe }} description "CUSTOMER:{{ datos.cliente }}"
                                    set interfaces {{ datos.interface_pe }} vlan-tagging
                                    del interfaces {{ datos.interface_pe }} disable
                                {% endif %}

                                {% if datos.unit_nid %}
                                    set interfaces {{ datos.interface_pe }} unit {{ datos.unit_nid }} description "CUSTOMER:{{ datos.cliente }}(CFS:{{ datos.cfs }})(RFS:{{ datos.rfs_ip_port_nid }})"
                                    set interfaces {{ datos.interface_pe }} unit {{ datos.unit_nid }} bandwidth 10m
                                    {% if datos.sv  !=  datos.cv %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit_nid }} vlan-tags outer 0x8100.{{ datos.sv }} inner 0x8100.{{ datos.cv }}{% endif %}
                                    {% if datos.sv  ==  datos.cv %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit_nid }} vlan-id {{ datos.unit_nid }} {% endif %}
                                    set interfaces {{ datos.interface_pe }} unit {{ datos.unit_nid }} family inet rpf-check mode loose
                                    set interfaces {{ datos.interface_pe }} unit {{ datos.unit_nid }} family inet filter input customer-cflow
                                    set interfaces {{ datos.interface_pe }} unit {{ datos.unit_nid }} family inet policer input ratelimit-10000000
                                    set interfaces {{ datos.interface_pe }} unit {{ datos.unit_nid }} family inet policer output ratelimit-10000000
                                    {% if datos.rfs_ip_port_nid != "" %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit_nid }} family inet address {{ datos.lnnid}}{% endif %}
                                
                                {% endif %}
                                
                                set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} description "CUSTOMER:{{ datos.cliente }}(CFS:{{ datos.cfs }})(RFS:{{ datos.rfs_ip_port }})"
                                set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} bandwidth {{ bwjun }}
                                {% if datos.sv  !=  datos.cv %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} vlan-tags outer 0x8100.{{ datos.sv }} inner 0x8100.{{ datos.cv }}{% endif %}
                                {% if datos.sv  ==  datos.cv %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} vlan-id {{ datos.cv }}{% endif %}
                                set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet rpf-check mode loose
                                set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet filter input customer-cflow
                                set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet policer input ratelimit-{{ bwjun }}
                                set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet policer output ratelimit-{{ bwjun }}
                                {% if datos.wan|mask == '31' %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet address {{ datos.wan}}{% endif %}
                                {% if datos.wan|mask != '31' %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet address {{ datos.wan|first_valid_ip_with_mask }}{% endif %}
                                {% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet6 rpf-check mode loose{% endif %}
                                {% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet6  filter input ipv6-customer-cflow{% endif %}
                                {% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet6 policer input ratelimit-{{ bwjun }}-IPV6{% endif %}
                                {% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet6 policer output ratelimit-{{ bwjun }}-IPV6{% endif %}
                                {% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}{% if datos.wanv6|maskv6 == '127' %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet6 address {{ datos.wanv6}}{% endif %}{% endif %}
                                {% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}{% if datos.wanv6|maskv6 != '127' %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet6 address {{ datos.wanv6|first_valid_ipv6_with_mask }}{% endif %}{% endif %}

                            {% else %}d
                                set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} escription "CUSTOMER:{{ datos.cliente }}(CFS:{{ datos.cfs }})(RFS:{{ datos.rfs_ip_port }})"
                                set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} bandwidth {{ bwjun }}
                                set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} vlan-tags outer 0x8100.{{ datos.sv }} inner 0x8100.{{ datos.cv }}
                                set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet rpf-check mode loose
                                set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet mtu 1500
                                set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet no-redirects
                                set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet filter input NETPROTECT-BE
                                set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet policer input CUSTOMER-{{  datos.bw }}M
                                set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet policer output CUSTOMER-{{  datos.bw }}M
                                {% if datos.wan|mask == '31' %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet address {{ datos.wan}}{% endif %}
                                {% if datos.wan|mask != '31' %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet address {{ datos.wan|first_valid_ip_with_mask }}{% endif %}
                                {% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet6 rpf-check mode loose{% endif %}
                                {% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet6 mtu 1500{% endif %}
                                {% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet6 filter input NETPROTECT-BE-IPv6{% endif %}
                                {% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet6 policer input CUSTOMER-IPV6-{{  datos.bw }}M{% endif %}
                                {% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet6 policer output CUSTOMER-IPV6-{{  datos.bw }}M{% endif %}
                                {% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}{% if datos.wanv6|maskv6 == '127' %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet6 address {{ datos.wanv6}}{% endif %}{% endif %}
                                {% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %} {% if datos.wanv6|maskv6 != '127' %}set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} family inet6 address {{ datos.wanv6|first_valid_ipv6_with_mask }}{% endif %}{% endif %}
                            
                            {% endif %}


                        {% elif datos.tipo_configuracion == "Alta" and datos.tipo_servicio == "ADI" and datos.tipo_equipo == "ALCATEL" %}

                            /configure service customer {{ datos.IES }} create
                            /configure service customer {{ datos.IES }} description "{{ datos.cliente }}"
                            /configure service ies {{ datos.IES }} customer {{ datos.IES }} create
                            /configure service ies {{ datos.IES }} no shutdown
                            exit
                            #####
                            /configure service ies {{ datos.IES }} interface {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}  create
                            /configure service ies {{ datos.IES }} interface {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }} description "CUSTOMER:{{ datos.cliente }}(CFS:{{ datos.cfs }})(RFS:{{ datos.rfs_ip_port }})"
                            /configure service ies {{ datos.IES }} interface {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }} create sap lag-{{num_puertos_lag}}:{{ datos.sv }}.{{ datos.cv }} create
                            /configure service ies {{ datos.IES }} interface {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }} create sap lag-{{num_puertos_lag}}:{{ datos.sv }}.{{ datos.cv }} ingress qos XXXXXXXXXXXXXXXXXXXXX
                            /configure service ies {{ datos.IES }} interface {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }} create sap lag-{{num_puertos_lag}}:{{ datos.sv }}.{{ datos.cv }}   egress agg-rate rate {{ bw_lag_alcatel }}
                            

                            {% if datos.wan|mask == '31' %}/configure service ies {{ datos.IES }} interface {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}  address {{ datos.wan }}{% endif %}
                            {% if datos.wan|mask != '31' %}/configure service ies {{ datos.IES }} interface {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}  address {{ datos.wan|first_valid_ip_with_mask }}{% endif %}

                            


                            /configure service ies {{ datos.IES }} interface {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}  urpf-check mode loose
                            /configure service ies {{ datos.IES }} interface {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}  ip-mtu 1500
                            /configure service ies {{ datos.IES }} interface {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}   cflowd-parameters sampling unicast type interface
                            /configure service ies {{ datos.IES }} interface {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}   tos-marking-state trusted
                            {% if datos.wanv6|maskv6 == '127' %}{% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}/configure service ies {{ datos.IES }} interface {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}  ipv6 address {{ datos.wanv6}}{% endif %}{% endif %}
                            {% if datos.wanv6|maskv6 != '127' %}{% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}/configure service ies {{ datos.IES }} interface {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}  ipv6 address {{ datos.wanv6|first_valid_ipv6_with_mask }}{% endif %}{% endif %}
                            /configure service ies {{ datos.IES }} interface {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}  enable-ingress-stats
                            /configure service ies {{ datos.IES }} interface {{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }} no shutdown
                            exit
                      
                        {% elif datos.tipo_configuracion == "Alta" and datos.tipo_servicio == "ADI" and datos.tipo_equipo == "ALCATEL_V" %}
                            {% if datos.sw  == '' %}

                                Configuación del breackout sobre el root port.
                                /configure port {{root_port}} admin-state enable
                                /configure port {{root_port}} description "$descripcion"
                                /configure port {{root_port}} connector { }
                                /configure port {{root_port}} connector { breakout $port_breakout }
                                Configuracion de los childs port asociados al root port
                                Esta configuración se debe aplicar, por cada child miembro del lag que se desea asociar, ejemplo si se necesita un LAG de 2x10G o 2x100G, se debe configurar cada child port con este template.
                                /configure port {{child_port}} admin-state enable
                                /configure port {{child_port}} description "$descripcion"
                                /configure port {{child_port}} ethernet { }
                                /configure port {{child_port}} ethernet { mode access }
                                /configure port {{child_port}} ethernet { encap-type $encap-type }
                                /configure port {{child_port}} ethernet { mtu {{mtu}} }
                                /configure port {{child_port}} ethernet { crc-monitor }
                                /configure port {{child_port}} ethernet { crc-monitor signal-degrade }
                                /configure port {{child_port}} ethernet { crc-monitor signal-degrade threshold 5 }
                                /configure port {{child_port}} ethernet { crc-monitor signal-degrade multiplier 2 }
                                /configure port {{child_port}} ethernet { egress }
                                /configure port {{child_port}} ethernet { egress port-scheduler-policy }
                                /configure port {{child_port}} ethernet { egress port-scheduler-policy policy-name "$bandwidth_access_scheduler" }
                            
                            {% elif datos.encap_type  == 'N/A' %}

                                {% if datos.cv %}

                                    #para un LAG con doble tag de Vlan

                                    #Limitacion de Rate

                                    #Para QoS

                                    /configure { service ies "{{ datos.cliente }}" interface {{datos.interface_pe}}:{{ datos.sv }}.{{ datos.cv }} sap lag-{{ datos.lag}}:{{ datos.sv }}.{{ datos.cv }} ingress qos sap-ingress policy-name xxxxx

                                    #Para agg-rate

                                    /configure { service ies "{{ datos.cliente }}"  interface {{datos.interface_pe}}:{{ datos.sv }}.{{ datos.cv }} sap lag-{{ datos.lag}}:{{ datos.sv }}.{{ datos.cv }} egress agg-rate rate {{shaping_rate}}
                                    #Customer
                                    /configure { service customer "{{ datos.cliente }}" }
                                    /configure { service customer "{{ datos.cliente }}" customer-id {{ datos.IES }} }
                                        
                                    #Service

                                    /configure { service ies "{{ datos.cliente }}" }
                                    /configure { service ies "{{ datos.cliente }}" admin-state enable }
                                    /configure { service ies "{{ datos.cliente }}" service-id {{ datos.IES }} }
                                    /configure { service ies "{{ datos.cliente }}" customer "{{ datos.cliente }}" }


                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" admin-state enable }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" description "CUSTOMER:{{ datos.cliente }}(CFS:{{ datos.cfs }})(RFS:{{ datos.rfs_ip_port }})" }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ingress-stats true }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" cflowd-parameters }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" cflowd-parameters sampling unicast }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" cflowd-parameters sampling unicast type interface }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" sap lag-{{ datos.lag}}:{{ datos.sv }}.{{ datos.cv }} }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" sap lag-{{ datos.lag}}:{{ datos.sv }}.{{ datos.cv }} admin-state enable }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv4 }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv4 urpf-check }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv4 urpf-check mode loose }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv4 bfd }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv4 bfd admin-state enable }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv4 bfd receive 2000 }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv4 bfd multiplier 3 }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv4 primary }
                                    {% if datos.wan|mask == '31' %}/configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv4 primary address {{ datos.wan|first_ip_no_mask }} } {% endif %}
                                    {% if datos.wan|mask != '31' %}/configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv4 primary address {{ datos.wan|first_valid_ip }} } {% endif %}

                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv4 primary prefix-length {{ datos.wan|mask }} }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv6 }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv6 urpf-check }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv6 urpf-check mode loose }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv6 bfd }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv6 bfd receive 500 }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv6 bfd multiplier 3 }


                                    {% if datos.wanv6|maskv6 == '127' %}{% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}/configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv6 address {{ datos.wanv6|first_ipv6_no_mask}} } {% endif %}{% endif %}
                                    {% if datos.wanv6|maskv6 == '127' %}{% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}/configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv6 address {{ datos.wanv6|first_ipv6_no_mask}} prefix-length {{ datos.wanv6|maskv6 }}} {% endif %}{% endif %}
                                    {% if datos.wanv6|maskv6 != '127' %}{% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}/configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv6 address {{ datos.wanv6|first_valid_ipv6 }} } {% endif %}{% endif %}                                            
                                    {% if datos.wanv6|maskv6 != '127' %}{% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}/configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}.{{ datos.cv }}" ipv6 address {{ datos.wanv6|first_valid_ipv6 }} prefix-length {{ datos.wanv6|maskv6 }}} {% endif %}{% endif %}
                                                                    
                                {% elif datos.sv %}

                                #para un LAG con un tag de Vlan

                                    #Limitacion de Rate

                                    #Para QoS

                                    service ies {{datos.IES}} interface {{datos.interface_pe}}:{{ datos.sv }} sap lag-{{ datos.lag}}:{{ datos.sv }} ingress qos sap-ingress policy-name 	xxxxx
                                    
                                    #Para agg-rate

                                    service ies {{datos.IES}} interface {{datos.interface_pe}}:{{ datos.sv }} sap lag-{{ datos.lag}}:{{ datos.sv }} egress agg-rate rate {{shaping_rate}}
                                    #Customer
                                    /configure { service customer "{{ datos.cliente }}" }
                                    /configure { service customer "{{ datos.cliente }}" customer-id {{ datos.IES }} }
                                        
                                    #Service

                                    /configure { service ies "{{ datos.cliente }}" }
                                    /configure { service ies "{{ datos.cliente }}" admin-state enable }
                                    /configure { service ies "{{ datos.cliente }}" service-id {{ datos.IES }} }
                                    /configure { service ies "{{ datos.cliente }}" customer "{{ datos.cliente }}" }

                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" admin-state enable }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" description "CUSTOMER:{{ datos.cliente }}(CFS:{{ datos.cfs }})(RFS:{{ datos.rfs_ip_port }})" }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ingress-stats true }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" cflowd-parameters }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" cflowd-parameters sampling unicast }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" cflowd-parameters sampling unicast type interface }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" sap lag-{{ datos.lag}}:{{ datos.sv }} }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" sap lag-{{ datos.lag}}:{{ datos.sv }} admin-state enable }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ipv4 }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ipv4 urpf-check }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ipv4 urpf-check mode loose }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ipv4 bfd }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ipv4 bfd admin-state enable }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ipv4 bfd receive 2000 }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ipv4 bfd multiplier 3 }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ipv4 primary }
                                    {% if datos.wan|mask == '31' %}/configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ipv4 primary address {{ datos.wan }} } {% endif %}
                                    {% if datos.wan|mask != '31' %}/configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ipv4 primary address {{ datos.wan|first_valid_ip }} } {% endif %}

                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ipv4 primary prefix-length {{ datos.wan|mask }} }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ipv6 }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ipv6 urpf-check }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ipv6 urpf-check mode loose }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ipv6 bfd }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ipv6 bfd receive 500 }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ipv6 bfd multiplier 3 }


                                    {% if datos.wanv6|maskv6 == '127' %}{% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}/configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ipv6 address {{ datos.wanv6|first_ipv6_no_mask}} } {% endif %}{% endif %}
                                    {% if datos.wanv6|maskv6 != '127' %}{% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}/configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ipv6 address {{ datos.wanv6|first_valid_ipv6 }} } {% endif %}{% endif %}
                                            
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:{{ datos.sv }}" ipv6 address {{ datos.wanv6|first_ipv6_no_mask}} prefix-length {{ datos.wanv6|maskv6 }} }

                                {% else %}

                                    #Configuración para un LAG Untagged

                                    #Limitacion de Rate

                                    #Para QoS

                                    service ies {{datos.IES}} interface {{datos.interface_pe}}:0 sap lag-{{ datos.lag}}:0 ingress qos sap-ingress policy-name 	xxxxx

                                    #Para agg-rate

                                    service ies {{datos.IES}} interface {{datos.interface_pe}}:0 sap lag-{{ datos.lag}}:0 egress agg-rate rate {{shaping_rate}}
                                    #Customer
                                    /configure { service customer "{{ datos.cliente }}" }
                                    /configure { service customer "{{ datos.cliente }}" customer-id {{ datos.IES }} }
                                        
                                    #Service

                                    /configure { service ies "{{ datos.cliente }}" }
                                    /configure { service ies "{{ datos.cliente }}" admin-state enable }
                                    /configure { service ies "{{ datos.cliente }}" service-id {{ datos.IES }} }
                                    /configure { service ies "{{ datos.cliente }}" customer "{{ datos.cliente }}" }


                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" admin-state enable }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" description "CUSTOMER:{{ datos.cliente }}(CFS:{{ datos.cfs }})(RFS:{{ datos.rfs_ip_port }})" }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ingress-stats true }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" cflowd-parameters }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" cflowd-parameters sampling unicast }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" cflowd-parameters sampling unicast type interface }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" sap lag-{{ datos.lag}}:0 }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" sap lag-{{ datos.lag}}:0 admin-state enable }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ipv4 }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ipv4 urpf-check }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ipv4 urpf-check mode loose }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ipv4 bfd }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ipv4 bfd admin-state enable }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ipv4 bfd receive 2000 }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ipv4 bfd multiplier 3 }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ipv4 primary }
                                    {% if datos.wan|mask == '31' %}/configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ipv4 primary address {{ datos.wan }} } {% endif %}
                                    {% if datos.wan|mask != '31' %}/configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ipv4 primary address {{ datos.wan|first_valid_ip }} } {% endif %}

                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ipv4 primary prefix-length {{ datos.wan|mask }} }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ipv6 }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ipv6 urpf-check }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ipv6 urpf-check mode loose }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ipv6 bfd }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ipv6 bfd receive 500 }
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ipv6 bfd multiplier 3 }


                                    {% if datos.wanv6|maskv6 == '127' %}{% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}/configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ipv6 address {{ datos.wanv6|first_ipv6_no_mask}} } {% endif %}{% endif %}
                                    {% if datos.wanv6|maskv6 != '127' %}{% if datos.wanv6 and datos.wanv6 != '2806:281::/32' %}/configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ipv6 address {{ datos.wanv6|first_valid_ipv6 }} } {% endif %}{% endif %}
                                            
                                    /configure { service ies "{{ datos.cliente }}" interface "{{ datos.interface_pe }}:0" ipv6 address {{ datos.wanv6|first_ipv6_no_mask}} prefix-length {{ datos.wanv6|maskv6 }} }

                                {% endif %}
                            {% else %}

                                /configure lag "lag-{{num_puertos_lag}}" { }
                                /configure lag "lag-{{num_puertos_lag}}" { admin-state enable }
                                /configure lag "lag-{{num_puertos_lag}}" { description "{{ datos.cliente }}" }
                                /configure lag "lag-{{num_puertos_lag}}" { encap-type {{ datos.encap_type }} }
                                /configure lag "lag-{{num_puertos_lag}}" { mode access }
                                /configure lag "lag-{{num_puertos_lag}}" { max-ports 64 }
                                /configure lag "lag-{{num_puertos_lag}}" { lacp }
                                /configure lag "lag-{{num_puertos_lag}}" { lacp mode active }
                                /configure lag "lag-{{num_puertos_lag}}" { lacp administrative-key {{datos.lag_administrative_key}} }

                            {% endif %}

                        {% else %}
                            ###No se cumple ninguna condición para nterface.
                        {% endif %}
                    </textarea>
                    <div class="button-container">
                        <button class="datos-button" onclick="copyToClipboard('newCommandsTextArea')" aria-label="Copiar Nuevos Comandos">Copiar Nuevos Comandos</button>
                        <button class="datos-button" onclick="generateTxt('newCommandsTextArea')" aria-label="Generar TXT">Generar TXT</button>

                    </div>
                </div>
                <div class="copy-box">
                    <div class="title">Policers</div>
                    <textarea id="policersTextArea" class="datos-textarea" readonly>

                        {% if datos.tipo_configuracion == "Modificacion" or datos.tipo_configuracion == "Ampliacion" and datos.tipo_servicio == "VPLS" %}

                            #PE {{ datos.pe }}

                            set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-cir-in if-exceeding bandwidth-limit {{ shaping_rate }}
                            set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-cir-in if-exceeding burst-size-limit {{burst_size_limit}}
                            set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-cir-in then discard

                            {% if datos.pe_b %} #################################################################{% endif %}

                            #PE {{ datos.pe_b }}
                            set firewall policer {{ datos.interface_pe_b }}.{{ datos.unit_b }}-cir-in if-exceeding bandwidth-limit {{ shaping_rate }}1
                            set firewall policer {{ datos.interface_pe_b }}.{{ datos.unit_b }}-cir-in if-exceeding burst-size-limit {{burst_size_limit}}
                            set firewall policer {{ datos.interface_pe_b }}.{{ datos.unit_b }}-cir-in then discard

                            


                        {% elif datos.tipo_configuracion == "Alta" and datos.tipo_servicio == "VPLS" and datos.tipo_equipo == "JUNIPER" %}
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}--inet-i term EF_DSCP from dscp 46
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term EF_DSCP then count EF.rx-{{ datos.interface_pe }}.{{ datos.unit }}-vpls-i
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term EF_DSCP then loss-priority low
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term EF_DSCP then forwarding-class EF
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term EF-DE_DSCP from dscp 34
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term EF_DE_DSCP then count EF-DE.rx-{{ datos.interface_pe }}.{{ datos.unit }}-vpls-e
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term EF-DE_DSCP then loss-priority high
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term EF-DE_DSCP then forwarding-class EF-DE
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term AF_DSCP from dscp 26
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term AF_DSCP then count AF-DE.rx-{{ datos.interface_pe }}.{{ datos.unit }}-vpls-e
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term AF_DSCP then loss-priority low
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term AF_DSCP then forwarding-class AF
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term AF-DE_DSCP from dscp 18
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term AF-DE_DSCP then count AF-DE.rx-{{ datos.interface_pe }}.{{ datos.unit }}4-vpls-e
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term AF-DE_DSCP then loss-priority high
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term AF-DE_DSCP then forwarding-class AF-DE
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term VPN-BE from dscp 10
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term VPN-BE then count VPN-BE.rx-{{ datos.interface_pe }}.{{ datos.unit }}-vpls-e
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term VPN-BE then loss-priority high
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term VPN-BE then forwarding-class VPN-BE
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term BE then count BE.rx-{{ datos.interface_pe }}.{{ datos.unit }}-vpls-e
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term BE then loss-priority high
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-vpls-e term BE then forwarding-class BE
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-cos-i term all then count EFlow.rx-{{ datos.interface_pe }}.{{ datos.unit }}-cos-i
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-cos-i term all then loss-priority high
                            set firewall family vpls filter {{ datos.interface_pe }}.{{ datos.unit }}-cos-i term all then forwarding-class EF
                            set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-cir-in logical-interface-policer
                            set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-cir-in if-exceeding bandwidth-limit {{ shaping_rate }}
                            set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-cir-in if-exceeding burst-size-limit {{burst_size_limit}}
                            set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-cir-in then discard

                            {% if datos.pe_b %} ############################################################{% endif %}

                            PE {{ datos.pe_b }}
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}--inet-i term EF_DSCP from dscp 46
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term EF_DSCP then count EF.rx-{{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-i
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term EF_DSCP then loss-priority low
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term EF_DSCP then forwarding-class EF
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term EF-DE_DSCP from dscp 34
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term EF_DE_DSCP then count EF-DE.rx-{{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term EF-DE_DSCP then loss-priority high
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term EF-DE_DSCP then forwarding-class EF-DE
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term AF_DSCP from dscp 26
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term AF_DSCP then count AF-DE.rx-{{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term AF_DSCP then loss-priority low
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term AF_DSCP then forwarding-class AF
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term AF-DE_DSCP from dscp 18
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term AF-DE_DSCP then count AF-DE.rx-{{ datos.interface_pe_b }}.{{ datos.unit_b }}4-vpls-e
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term AF-DE_DSCP then loss-priority high
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term AF-DE_DSCP then forwarding-class AF-DE
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term VPN-BE from dscp 10
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term VPN-BE then count VPN-BE.rx-{{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term VPN-BE then loss-priority high
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term VPN-BE then forwarding-class VPN-BE
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term BE then count BE.rx-{{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term BE then loss-priority high
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-vpls-e term BE then forwarding-class BE
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-cos-i term all then count EFlow.rx-{{ datos.interface_pe_b }}.{{ datos.unit_b }}-cos-i
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-cos-i term all then loss-priority high
                            set firewall family vpls filter {{ datos.interface_pe_b }}.{{ datos.unit_b }}-cos-i term all then forwarding-class EF
                            set firewall policer {{ datos.interface_pe_b }}.{{ datos.unit_b }}-cir-in logical-interface-policer
                            set firewall policer {{ datos.interface_pe_b }}.{{ datos.unit_b }}-cir-in if-exceeding bandwidth-limit {{ shaping_rate }}
                            set firewall policer {{ datos.interface_pe_b }}.{{ datos.unit_b }}-cir-in if-exceeding burst-size-limit {{burst_size_limit}}
                            set firewall policer {{ datos.interface_pe_b }}.{{ datos.unit_b }}-cir-in then discard

                            

                        {% elif datos.tipo_configuracion == "Ampliacion" and datos.tipo_servicio == "VPN" %}

                            set class-of-service traffic-control-profiles {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o scheduler-map GX-CUST-SCHEDULER-MAP-6Q
                            set class-of-service traffic-control-profiles {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o shaping-rate {{ shaping_rate }}
                            set class-of-service traffic-control-profiles {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o delay-buffer-rate {{delay_buffer_rate}}
                            set class-of-service interfaces {{ datos.interface_pe }} unit {{ datos.unit }} output-traffic-control-profile {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o

                            set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in if-exceeding bandwidth-limit {{ shaping_rate }}
                            set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in if-exceeding burst-size-limit {{burst_size_limit}}
                            set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in then discard

                            

                            {% elif datos.tipo_configuracion == "Alta" and datos.tipo_servicio == "VPN" and datos.tipo_equipo == "JUNIPER" %}

                            #AVJ
                            {% if "-1-" in datos.vrf|strip %}
                            #AVJ-1-

                                {% if datos.bw_plus and datos.bw_plus != '0' %}
                                #AVJ-1-QoS

									set class-of-service traffic-control-profiles {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o scheduler-map GX-CUST-SCHEDULER-MAP-I
									set class-of-service traffic-control-profiles {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o shaping-rate {{ datos.bw }}m
									set class-of-service traffic-control-profiles {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o delay-buffer-rate {{delay_buffer_rate}}
									set class-of-service interfaces {{ datos.interface_pe }} unit {{ datos.unit }} output-traffic-control-profile {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF_DSCP from dscp 46
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF_DSCP then policer {{ datos.interface_pe }}.{{ datos.unit }}.EF-i
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF_DSCP then count EF.rx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-i
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF_DSCP then loss-priority low
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF_DSCP then forwarding-class EF
                                    set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF-DE_DSCP from dscp 32
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF-DE_DSCP from dscp 34
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF-DE_DSCP from dscp 36
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF-DE_DSCP from dscp 38
                                    set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF-DE_DSCP from dscp 40
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF-DE_DSCP then policer {{ datos.interface_pe }}.{{ datos.unit }}.EF-i
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF-DE_DSCP then count EF-DE.rx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-i
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF-DE_DSCP then loss-priority high
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF-DE_DSCP then forwarding-class EF
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF_DSCP from dscp 16
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF_DSCP from dscp 24
                                    set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF_DSCP from dscp 26
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF_DSCP from dscp 28
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF_DSCP then policer {{ datos.interface_pe }}.{{ datos.unit }}.AF-i
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF_DSCP then count AF.rx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-i
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF_DSCP then loss-priority low
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF_DSCP then forwarding-class AF
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF-DE_DSCP from dscp 18
                                    set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF-DE_DSCP from dscp 20
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF-DE_DSCP from dscp 22
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF-DE_DSCP from dscp 30
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF-DE_DSCP then policer {{ datos.interface_pe }}.{{ datos.unit }}.AF-i
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF-DE_DSCP then count AF-DE.rx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-i
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF-DE_DSCP then loss-priority high
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF-DE_DSCP then forwarding-class AF
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term BE-DE then count BE-DE.rx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-i
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term BE-DE then loss-priority high
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term BE-DE then forwarding-class BE

									set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}.EF-i filter-specific
									set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}.EF-i if-exceeding bandwidth-limit {{bw_Exchange_por}}
									set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}.EF-i if-exceeding burst-size-limit {{burst_size_limit_Exchange}}
									set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}.EF-i then discard

									set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}.AF-i filter-specific
									set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}.AF-i if-exceeding bandwidth-limit {{bw_plus_por}}
									set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}.AF-i if-exceeding burst-size-limit {{burst_size_limit_plus}}
									set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}.AF-i then loss-priority high
									set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}.AF-i then forwarding-class VPN-BE

                                    set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in logical-interface-policer
                                    set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in if-exceeding bandwidth-limit {{ shaping_rate }}
                                    set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in if-exceeding burst-size-limit {{burst_size_limit}}
                                    set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in then discard
                                    set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-out logical-interface-policer
                                    set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-out if-exceeding bandwidth-limit {{ shaping_rate }}
                                    set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-out if-exceeding burst-size-limit {{burst_size_limit}}
                                    set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-out then discard
                                    
                                {% else %}
                                #AVJ-1-No-QoS

                                    set class-of-service traffic-control-profiles {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o scheduler-map GX-CUST-SCHEDULER-MAP-I
									set class-of-service traffic-control-profiles {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o shaping-rate {{ datos.bw }}m
									set class-of-service traffic-control-profiles {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o delay-buffer-rate {{delay_buffer_rate}}
									set class-of-service interfaces {{ datos.interface_pe }} unit {{ datos.unit }} output-traffic-control-profile {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF_DSCP from dscp 46
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF_DSCP then count EF.rx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-i
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF_DSCP then loss-priority low
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF_DSCP then forwarding-class EF
                                    set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF-DE_DSCP from dscp 32
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF-DE_DSCP from dscp 34
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF-DE_DSCP from dscp 36
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF-DE_DSCP from dscp 38
                                    set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF-DE_DSCP from dscp 40
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF-DE_DSCP then loss-priority high
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF-DE_DSCP then forwarding-class EF
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF_DSCP from dscp 16
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF_DSCP from dscp 24
                                    set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF_DSCP from dscp 26
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF_DSCP from dscp 28
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF_DSCP then count AF.rx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-i
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF_DSCP then loss-priority low
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF_DSCP then forwarding-class AF
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF-DE_DSCP from dscp 18
                                    set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF-DE_DSCP from dscp 20
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF-DE_DSCP from dscp 22
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF-DE_DSCP from dscp 30
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF-DE_DSCP then count AF-DE.rx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-i
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF-DE_DSCP then loss-priority high
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF-DE_DSCP then forwarding-class AF
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term BE-DE then count BE-DE.rx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-i
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term BE-DE then loss-priority high
									set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term BE-DE then forwarding-class BE



                                    set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in logical-interface-policer
                                    set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in if-exceeding bandwidth-limit {{ shaping_rate }}
                                    set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in if-exceeding burst-size-limit {{burst_size_limit}}
                                    set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in then discard
                                    set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-out logical-interface-policer
                                    set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-out if-exceeding bandwidth-limit {{ shaping_rate }}
                                    set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-out if-exceeding burst-size-limit {{burst_size_limit}}
                                    set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-out then discard
                                {% endif %}

                            {% else %}
   
                                set class-of-service traffic-control-profiles {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o scheduler-map GX-CUST-SCHEDULER-MAP-6Q
                                set class-of-service traffic-control-profiles {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o shaping-rate {{ shaping_rate }}
                                set class-of-service traffic-control-profiles {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o delay-buffer-rate {{delay_buffer_rate}}
                                set class-of-service interfaces {{ datos.interface_pe }} unit {{ datos.unit }} output-traffic-control-profile {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o
                                set class-of-service interfaces {{ datos.interface_pe }} unit {{ datos.unit }} rewrite-rules ieee-802.1 XMR-I
                                set class-of-service interfaces {{ datos.interface_pe }} unit {{ datos.unit }} rewrite-rules ieee-802.1 CUST-PSR->EX
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF_DSCP from dscp 46
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF_DSCP then count EF.rx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-i
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF_DSCP then loss-priority low
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF_DSCP then forwarding-class EF
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF-DE_DSCP from dscp 34
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF-DE_DSCP then count EF-DE.rx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-i
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF-DE_DSCP then loss-priority high
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term EF-DE_DSCP then forwarding-class EF-DE
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF_DSCP from dscp 26
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF_DSCP then count AF-DE.rx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-i
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF_DSCP then loss-priority low
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF_DSCP then forwarding-class AF
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF-DE_DSCP from dscp 18
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF-DE_DSCP then count AF-DE.rx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-i
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF-DE_DSCP then loss-priority high
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term AF-DE_DSCP then forwarding-class AF-DE
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term VPN-BE from dscp 10
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term VPN-BE then count VPN-BE.rx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-i
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term VPN-BE then loss-priority high
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term VPN-BE then forwarding-class VPN-BE
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term BE then count BE.rx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-i
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term BE then loss-priority high
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-i term BE then forwarding-class BE
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-e term EF_DSCP from dscp 46
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-e term EF_DSCP then count EF.tx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-e
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-e term EF-DE_DSCP from dscp 34
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-e term EF-DE_DSCP then count EF-DE.tx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-e
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-e term AF_DSCP then count AF-DE.tx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-e
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-e term AF-DE_DSCP from dscp 18
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-e term AF-DE_DSCP then count AF-DE.tx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-e
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-e term AF_DSCP from dscp 26
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-e term VPN-BE from dscp 10
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-e term VPN-BE then count VPN-BE.tx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-e
                                set firewall family inet filter {{ datos.interface_pe }}.{{ datos.unit }}-inet-e term BE then count BE.tx-{{ datos.interface_pe }}.{{ datos.unit }}-inet-e
                                set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in logical-interface-policer
                                set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in if-exceeding bandwidth-limit {{ shaping_rate }}
                                set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in if-exceeding burst-size-limit {{burst_size_limit}}
                                set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in then discard
                                set routing-instances {{ datos.vrf }} interface {{ datos.interface_pe }}.{{ datos.unit }}

                                

                        {% endif %}

                            

                        {% elif datos.tipo_configuracion == "Alta" and datos.tipo_servicio == "ADI" and datos.tipo_equipo == "JUNIPER" %}
                               {% if "edge" in datos.pe|strip %}
                                    set firewall policer ratelimit-{{  bwjun }} logical-interface-policer
                                    set firewall policer ratelimit-{{  bwjun }} if-exceeding bandwidth-limit {{  bwjun }}
                                    set firewall policer ratelimit-{{  bwjun }} if-exceeding burst-size-limit {{  burst_size_limit }}
                                    set firewall policer ratelimit-{{  bwjun }} then discard
                                    set firewall policer ratelimit-{{  bwjun }}-IPV6 logical-interface-policer
                                    set firewall policer ratelimit-{{  bwjun }}-IPV6 if-exceeding bandwidth-limit {{  bwjun }}
                                    set firewall policer ratelimit-{{  bwjun }}-IPV6 if-exceeding burst-size-limit {{  burst_size_limit }}
                                    set firewall policer ratelimit-{{  bwjun }}-IPV6 then discard

                                    
                                {% else %}
                                    set firewall policer CUSTOMER-{{  datos.bw }}M logical-interface-policer
                                    set firewall policer CUSTOMER-{{  datos.bw }}M if-exceeding bandwidth-limit {{  bwjun }}
                                    set firewall policer CUSTOMER-{{  datos.bw }}M if-exceeding burst-size-limit {{  burst_size_limit }}
                                    set firewall policer CUSTOMER-{{  datos.bw }}M then discard
                                    set firewall policer CUSTOMER-IPV6-{{  datos.bw }}M logical-interface-policer
                                    set firewall policer CUSTOMER-IPV6-{{  datos.bw }}M if-exceeding bandwidth-limit {{  bwjun }}
                                    set firewall policer CUSTOMER-IPV6-{{  datos.bw }}M if-exceeding burst-size-limit {{  burst_size_limit }}
                                    set firewall policer CUSTOMER-IPV6-{{  datos.bw }}M then discard

                            
                            {% endif %}


                        {% else %}
                                ### No se cumple ninguna condición para policer.
                        {% endif %}

                    </textarea>
                    <div class="button-container">
                        <button class="datos-button" onclick="copyToClipboard('policersTextArea')" aria-label="Copiar Policers">Copiar Policers</button>
                        <button class="datos-button" onclick="generatePolicerTxt('policersTextArea')" aria-label="Generar Policer">Generar Policer</button>



                    </div>
                </div>
                <div class="copy-box">
                    <div class="title">Bgp</div>
                    <textarea id="BgpTextArea" class="datos-textarea" readonly>

                        {% if datos.tipo_configuracion == "Modificacion" and datos.tipo_servicio == "VPLS" %}
                            PE {{ datos.pe }}
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} description "CUSTOMER:{{ datos.cliente }}(CFS:{{ datos.cfs }})(RFS:{{ datos.rfs_ip_port }})"

                            {% if datos.pe_b %} #####{% endif %}

                            PE {{ datos.pe_b }}
                            set interfaces {{ datos.interface_pe_b }} unit {{ datos.unit_b }} description "CUSTOMER:{{ datos.cliente }}(CFS:{{ datos.cfs }})(RFS:{{ datos.rfs_ip_port_b }})"

                            
                        
                        {% elif datos.tipo_configuracion == "Alta" and datos.tipo_servicio == "VPLS" and datos.tipo_equipo == "JUNIPER" %}

                            {% if datos.pe_b %} #####{% endif %}

                            PE {{ datos.pe_b }}
                            set interfaces {{ datos.interface_pe_b }} unit {{ datos.unit_b }} description "CUSTOMER:{{ datos.cliente }}(CFS:{{ datos.cfs }})(RFS:{{ datos.rfs_ip_port_b }})"

                            
                        
                        {% elif datos.tipo_configuracion == "Ampliacion" and datos.tipo_servicio == "VPN" %}

                            set class-of-service traffic-control-profiles {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o scheduler-map GX-CUST-SCHEDULER-MAP-6Q
                            set class-of-service traffic-control-profiles {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o shaping-rate {{ shaping_rate }}
                            set class-of-service traffic-control-profiles {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o delay-buffer-rate {{delay_buffer_rate}}
                            set class-of-service interfaces {{ datos.interface_pe }} unit {{ datos.unit }} output-traffic-control-profile {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o

                            set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in if-exceeding bandwidth-limit {{ shaping_rate }}
                            set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in if-exceeding burst-size-limit {{burst_size_limit}}
                            set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in then discard

                            

                        {% elif datos.tipo_configuracion == "Alta" and datos.tipo_servicio == "VPN" and datos.tipo_equipo == "JUNIPER" %}
                            {% if "-1-" in datos.vrf|strip %}

                                set routing-instances {{ datos.vrf }} protocols bgp path-selection always-compare-med
                                set routing-instances {{ datos.vrf }} protocols bgp family inet any
                                set routing-instances {{ datos.vrf }} protocols bgp group {{ datos.sede }}-7{{ datos.cfs }} type external
                                set routing-instances {{ datos.vrf }} protocols bgp group {{ datos.sede }}-7{{ datos.cfs }} log-updown
                                set routing-instances {{ datos.vrf }} protocols bgp group {{ datos.sede }}-7{{ datos.cfs }} import BGP-import
                                set routing-instances {{ datos.vrf }} protocols bgp group {{ datos.sede }}-7{{ datos.cfs }} family inet any prefix-limit maximum 5000
                                set routing-instances {{ datos.vrf }} protocols bgp group {{ datos.sede }}-7{{ datos.cfs }} family inet any prefix-limit teardown 90
                                set routing-instances {{ datos.vrf }} protocols bgp group {{ datos.sede }}-7{{ datos.cfs }} family inet any prefix-limit teardown idle-timeout 120
                                set routing-instances {{ datos.vrf }} protocols bgp group {{ datos.sede }}-7{{ datos.cfs }} export BGP-export
                                set routing-instances {{ datos.vrf }} protocols bgp group {{ datos.sede }}-7{{ datos.cfs }} export "numeros iniciales de VRF Azul"-1-{{ datos.sede }}7{{ datos.cfs }}-export
                                set policy-options "numeros iniciales de VRF Azul"-1-{{ datos.sede }}7{{ datos.cfs }}-export then accept 
                                set routing-instances {{ datos.vrf }} protocols bgp group {{ datos.sede }}-7{{ datos.cfs }} peer-as {{ datos.asn }}
                                set routing-instances {{ datos.vrf }} protocols bgp group {{ datos.sede }}-7{{ datos.cfs }} as-override
                                set routing-instances {{ datos.vrf }} protocols bgp group {{ datos.sede }}-7{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }}


                            {% else %}

                                show routing-instances {{ datos.vrf }} protocols bgp | display set  | match type
                                #
                                #
                                set routing-instances {{ datos.vrf }} protocols bgp group external type external
                                set routing-instances {{ datos.vrf }} protocols bgp group external family inet unicast
                                set routing-instances {{ datos.vrf }} protocols bgp group external export bgp-export-policy
                                #
                                set routing-instances {{ datos.vrf }} protocols bgp group external neighbor {{ datos.wan|second_valid_ip }} peer-as {{ datos.asn }}
                                set routing-instances {{ datos.vrf }} protocols bgp group external neighbor {{ datos.wan|second_valid_ip }} as-override
                                show routing-instances {{ datos.vrf }} protocols bgp group external neighbor  {{ datos.wan|second_valid_ip }} | display set

                            {% endif %}
                            #
                            #
                            {% if datos.lbcpe and datos.lbcpe != 'None' %}set routing-instances {{ datos.vrf }} routing-options static route {{ datos.lbcpe }} next-hop {{ datos.wan|second_valid_ip }} tag 14{% endif %}

                            show routing-instances  {{ datos.vrf }} | display set | match  {{ datos.wan|second_valid_ip }}

                        {% elif datos.tipo_configuracion == "Alta" and datos.tipo_servicio == "ADI" and datos.tipo_equipo == "JUNIPER" %}
                            {% if datos.asn %}
                                {% if datos.wan|mask != '31' %}
                                    set protocols bgp group AS{{ datos.asn }}-{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} passive
                                    set protocols bgp group AS{{ datos.asn }}-{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} advertise-peer-as
                                    set protocols bgp group AS{{ datos.asn }}-{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} import transit-customer-map
                                    set protocols bgp group AS{{ datos.asn }}-{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} import CUSTOMER:AS{{ datos.asn }}-{{ datos.cfs }}
                                    set protocols bgp group AS{{ datos.asn }}-{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} family inet any prefix-limit maximum 4000
                                    set protocols bgp group AS{{ datos.asn }}-{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} family inet any prefix-limit teardown idle-timeout 5
                                    set protocols bgp group AS{{ datos.asn }}-{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} export default-originate
                                    set protocols bgp group AS{{ datos.asn }}-{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} remove-private
                                    set protocols bgp group AS{{ datos.asn }}-{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} peer-as {{ datos.asn }}
                                {% endif %}
                                {% for lan_ip, mask in lan_ips_with_masks %}
                                    set policy-options policy-statement CUSTOMER:AS{{ datos.asn }}-{{ datos.cfs }} term accept from route-filter {{ lan_ip }} upto /{{ mask }}
                                {% endfor %}
                                set policy-options policy-statement CUSTOMER:AS{{ datos.asn }}-{{ datos.cfs }} term accept then next policy
                                set policy-options policy-statement CUSTOMER:AS{{ datos.asn }}-{{ datos.cfs }} term accept then accept
                                set policy-options policy-statement CUSTOMER:AS{{ datos.asn }}-{{ datos.cfs }} term reject from as-path all-routes
                                set policy-options policy-statement CUSTOMER:AS{{ datos.asn }}-{{ datos.cfs }} term reject then reject
                            

                                {% else %}

                                {% if "edge" in datos.pe|strip %}

                                    {% for lan_ip, mask in lan_ips_with_masks %}
                                        {% if datos.wan|mask == '31' %}set routing-options static route  {{ lan_ip}} next-hop  {{ datos.wan|first_valid_ip }} community 3356:123 community 3356:22{% endif %}
                                        {% if datos.wan|mask != '31' %}set routing-options static route  {{ lan_ip}} next-hop  {{ datos.wan|second_valid_ip }} community 3356:123 community 3356:22{% endif %}
                                        {% if datos.wanv6|maskv6 == '127' %}set routing-options rib inet6.0 static route {{ datos.lanv6 }} next-hop  {{ datos.wanv6|first_valid_ipv6 }} community 3356:123 community 3356:22{% endif %}
                                        {% if datos.wanv6|maskv6 != '127' %}set routing-options rib inet6.0 static route {{ datos.lanv6 }} next-hop  {{ datos.wanv6|second_valid_ipv6 }} community 3356:123 community 3356:22{% endif %}
                                    {% endfor %}
                                {% else %}

                                    {% for lan_ip, mask in lan_ips_with_masks %}
                                        {% if datos.wan|mask == '31' %}set routing-options static route  {{ lan_ip}} next-hop  {{ datos.wan|first_valid_ip }} {% endif %}
                                        {% if datos.wan|mask != '31' %}set routing-options static route  {{ lan_ip}} next-hop  {{ datos.wan|second_valid_ip }} {% endif %}
                                        {% if datos.wanv6|maskv6 == '127' %}set routing-options rib inet6.0 static route {{ datos.lanv6 }} next-hop  {{ datos.wanv6|first_valid_ipv6 }} {% endif %}
                                        {% if datos.wanv6|maskv6 != '127' %}set routing-options rib inet6.0 static route {{ datos.lanv6 }} next-hop  {{ datos.wanv6|second_valid_ipv6 }} {% endif %}
                                    {% endfor %}
                                {% endif %}
                            {% endif %}

                        {% elif datos.tipo_configuracion == "Alta" and datos.tipo_servicio == "ADI" and datos.tipo_equipo == "ALCATEL" %}

                            {% if datos.asn %}                        
                            
                                /configure router policy-options begin
                                {% for lan_ip, mask in lan_ips_with_masks %}
                                /configure router policy-options prefix-list PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }} prefix {{ lan_ip }} through {{ mask }}
                                {% endfor %}
                                /configure router policy-options policy-statement PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }}  entry 5 description AS{{datos.asn}}-PREFIXIES
                                /configure router policy-options policy-statement PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }}  entry 5 from prefix-list PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }}
                                /configure router policy-options policy-statement PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }}  entry 5 action next-policy
                                /configure router policy-options policy-statement PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }}  entry 10 from as-path all-routes
                                /configure router policy-options policy-statement PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }}  entry 10 action reject
                                /configure router policy-options policy-statement PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }}  default-action reject

                                /configure router policy-options commit
                                exit

                                /configure router bgp group PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }} type external
                                /configure router bgp group PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }} peer-as {{ datos.asn }}
                                /configure router bgp group PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} description "{{ datos.cliente}}"
                                /configure router bgp group PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} remove-private
                                /configure router bgp group PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} family ipv4
                                /configure router bgp group PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} import PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }}
                                /configure router bgp group PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} export "send-default" "none"
                                /configure router bgp group PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} prefix-limit ipv4 2000 threshold 90 idle-timeout 5

                                /configure filter match-list ip-prefix-list "cust-bgp" prefix {{ datos.wan|second_valid_ip }}/32

                                /configure router policy-options abort
                                /configure router policy-options begin
                                /configure router policy-options policy-statement "PEER-{{ datos.wanv6|second_valid_ipv6 }}" entry 10 description "PEER-{{ datos.wanv6|second_valid_ipv6 }}_{{ datos.cfs }}-PREFIXIES"
                                /configure router policy-options policy-statement "PEER-{{ datos.wanv6|second_valid_ipv6 }}" entry 10 from prefix-list "PEER-{{ datos.wanv6|second_valid_ipv6 }}"
                                /configure router policy-options policy-statement "PEER-{{ datos.wanv6|second_valid_ipv6 }}" entry 10 action next-policy
                                /configure router policy-options policy-statement "PEER-{{ datos.wanv6|second_valid_ipv6 }}" entry 20 from as-path "all-routes"
                                /configure router policy-options policy-statement "PEER-{{ datos.wanv6|second_valid_ipv6 }}" entry 20 action reject
                                /configure router policy-options policy-statement "PEER-{{ datos.wanv6|second_valid_ipv6 }}"  default-action reject

                                {% for lanv6_ip, mask in lanv6_ips_with_masks %}
                                    /configure router policy-options prefix-list "PEER-{{ datos.wanv6|second_valid_ipv6 }}" prefix {{ lanv6_ip }} through {{ mask }}
                                {% endfor %}

                                /configure router policy-options commit
                                exit

                                /configure router bgp group "PEER-{{ datos.wanv6|second_valid_ipv6 }}" family ipv6
                                /configure router bgp group "PEER-{{ datos.wanv6|second_valid_ipv6 }}" type external
                                /configure router bgp group "PEER-{{ datos.wanv6|second_valid_ipv6 }}" peer-as {{ datos.asn }}

                                /configure router bgp group "PEER-{{ datos.wanv6|second_valid_ipv6 }}" neighbor {{ datos.wanv6|second_valid_ipv6 }} description "{{ datos.cliente }}"
                                /configure router bgp group "PEER-{{ datos.wanv6|second_valid_ipv6 }}" neighbor {{ datos.wanv6|second_valid_ipv6 }} remove-private
                                /configure router bgp group "PEER-{{ datos.wanv6|second_valid_ipv6 }}" neighbor {{ datos.wanv6|second_valid_ipv6 }} family ipv6
                                /configure router bgp group "PEER-{{ datos.wanv6|second_valid_ipv6 }}_500017457" neighbor {{ datos.wanv6|second_valid_ipv6 }} import "PEER-{{ datos.wanv6|second_valid_ipv6 }}_{{ datos.cfs }}"
                                /configure router bgp group "PEER-{{ datos.wanv6|second_valid_ipv6 }}" neighbor {{ datos.wanv6|second_valid_ipv6 }} export "ipv6-send-default" "none"
                                /configure router bgp group "PEER-{{ datos.wanv6|second_valid_ipv6 }}" neighbor {{ datos.wanv6|second_valid_ipv6 }} prefix-limit ipv6 2000 threshold 90 idle-timeout 5

                                /configure filter match-list ipv6-prefix-list "cust-bgp-ipv6" prefix {{ datos.wanv6|second_valid_ipv6 }}/128

                                admin display-config | match {{ datos.wan|second_valid_ip }} context all
                                admin display-config | match {{ datos.wanv6|second_valid_ipv6 }} context all

                            {% else %}

                                {% for lan_ip in lan_ips %}
                                {% if datos.wan|mask == '31' %}/configure router static-route-entry {{ lan_ip }} next-hop  {{ datos.wan|first_valid_ip }} no shutdown {% endif %}
                                {% if datos.wan|mask != '31' %}/configure router static-route-entry  {{ lan_ip }} next-hop  {{ datos.wan|second_valid_ip }} no shutdown {% endif %}
                                {% endfor %}

                                {% for lanv6_ip in lanv6_ips %}
                                    {% if datos.wanv6|maskv6 == '127' %}/configure router static-route-entry {{ lanv6_ip }} next-hop  {{ datos.wanv6|first_valid_ipv6 }} no shutdown {% endif %}
                                    {% if datos.wanv6|maskv6 != '127' %}/configure router static-route-entry {{ lanv6_ip }} next-hop  {{ datos.wanv6|second_valid_ipv6 }} shutdown {% endif %}
                                {% endfor %}

                            {% endif %} 

                            {% if datos.wan|mask == '31' %}admin display-config | match {{ datos.wan|first_valid_ip }} context all{% endif %}
                            {% if datos.wan|mask != '31' %}admin display-config | match {{ datos.wan|second_valid_ip }} context all{% endif %}

                            {% if datos.wanv6|maskv6 == '127' %}admin display-config | match {{ datos.wanv6|first_valid_ipv6 }} context all{% endif %}
                            {% if datos.wanv6|maskv6 != '127' %}admin display-config | match {{ datos.wanv6|second_valid_ipv6 }} context all{% endif %}
                         
                        
                            {% elif datos.tipo_configuracion == "Alta" and datos.tipo_servicio == "ADI" and datos.tipo_equipo == "ALCATEL_V" %}

                            {% if datos.asn %}                        
                            
                                /configure router policy-options begin
                                {% for lan_ip, mask in lan_ips_with_masks %}
                                /configure router policy-options prefix-list PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }} prefix {{ lan_ip }} through {{ mask }}
                                {% endfor %}
                                /configure router policy-options policy-statement PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }}  entry 5 description AS{{datos.asn}}-PREFIXIES
                                /configure router policy-options policy-statement PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }}  entry 5 from prefix-list PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }}
                                /configure router policy-options policy-statement PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }}  entry 5 action next-policy
                                /configure router policy-options policy-statement PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }}  entry 10 from as-path all-routes
                                /configure router policy-options policy-statement PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }}  entry 10 action reject
                                /configure router policy-options policy-statement PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }}  default-action reject

                                /configure router policy-options commit
                                exit

                                /configure router bgp group PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }} type external
                                /configure router bgp group PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }} peer-as {{ datos.asn }}
                                /configure router bgp group PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} description "{{ datos.cliente}}"
                                /configure router bgp group PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} remove-private
                                /configure router bgp group PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} family ipv4
                                /configure router bgp group PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} import PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }}
                                /configure router bgp group PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} export "send-default" "none"
                                /configure router bgp group PEER-{{ datos.wan|second_valid_ip }}_{{ datos.cfs }} neighbor {{ datos.wan|second_valid_ip }} prefix-limit ipv4 2000 threshold 90 idle-timeout 5

                                /configure filter match-list ip-prefix-list "cust-bgp" prefix {{ datos.wan|second_valid_ip }}/32

                                /configure router policy-options abort
                                /configure router policy-options begin
                                /configure router policy-options policy-statement "PEER-{{ datos.wanv6|second_valid_ipv6 }}" entry 10 description "PEER-{{ datos.wanv6|second_valid_ipv6 }}_{{ datos.cfs }}-PREFIXIES"
                                /configure router policy-options policy-statement "PEER-{{ datos.wanv6|second_valid_ipv6 }}" entry 10 from prefix-list "PEER-{{ datos.wanv6|second_valid_ipv6 }}"
                                /configure router policy-options policy-statement "PEER-{{ datos.wanv6|second_valid_ipv6 }}" entry 10 action next-policy
                                /configure router policy-options policy-statement "PEER-{{ datos.wanv6|second_valid_ipv6 }}" entry 20 from as-path "all-routes"
                                /configure router policy-options policy-statement "PEER-{{ datos.wanv6|second_valid_ipv6 }}" entry 20 action reject
                                /configure router policy-options policy-statement "PEER-{{ datos.wanv6|second_valid_ipv6 }}"  default-action reject

                                {% for lanv6_ip, mask in lanv6_ips_with_masks %}
                                    /configure router policy-options prefix-list "PEER-{{ datos.wanv6|second_valid_ipv6 }}" prefix {{ lanv6_ip }} through {{ mask }}
                                {% endfor %}

                                /configure router policy-options commit
                                exit

                                /configure router bgp group "PEER-{{ datos.wanv6|second_valid_ipv6 }}" family ipv6
                                /configure router bgp group "PEER-{{ datos.wanv6|second_valid_ipv6 }}" type external
                                /configure router bgp group "PEER-{{ datos.wanv6|second_valid_ipv6 }}" peer-as {{ datos.asn }}

                                /configure router bgp group "PEER-{{ datos.wanv6|second_valid_ipv6 }}" neighbor {{ datos.wanv6|second_valid_ipv6 }} description "{{ datos.cliente }}"
                                /configure router bgp group "PEER-{{ datos.wanv6|second_valid_ipv6 }}" neighbor {{ datos.wanv6|second_valid_ipv6 }} remove-private
                                /configure router bgp group "PEER-{{ datos.wanv6|second_valid_ipv6 }}" neighbor {{ datos.wanv6|second_valid_ipv6 }} family ipv6
                                /configure router bgp group "PEER-{{ datos.wanv6|second_valid_ipv6 }}_500017457" neighbor {{ datos.wanv6|second_valid_ipv6 }} import "PEER-{{ datos.wanv6|second_valid_ipv6 }}_{{ datos.cfs }}"
                                /configure router bgp group "PEER-{{ datos.wanv6|second_valid_ipv6 }}" neighbor {{ datos.wanv6|second_valid_ipv6 }} export "ipv6-send-default" "none"
                                /configure router bgp group "PEER-{{ datos.wanv6|second_valid_ipv6 }}" neighbor {{ datos.wanv6|second_valid_ipv6 }} prefix-limit ipv6 2000 threshold 90 idle-timeout 5

                                /configure filter match-list ipv6-prefix-list "cust-bgp-ipv6" prefix {{ datos.wanv6|second_valid_ipv6 }}/128

                                admin display-config | match {{ datos.wan|second_valid_ip }} context all
                                admin display-config | match {{ datos.wanv6|second_valid_ipv6 }} context all

                            {% else %}

                                {% for lan_ip in lan_ips %}

                                {% if datos.wan|mask == '31' %}
                                /configure router "Base" static-routes route {{ lan_ip }} route-type unicast { }
                                /configure { router "Base" static-routes route {{ lan_ip }} route-type unicast  tag 4100 }
                                /configure router "Base" static-routes route {{ lan_ip }} route-type unicast { next-hop "{{ datos.wan|first_valid_ip }}" }
                                /configure router "Base" static-routes route {{ lan_ip }} route-type unicast { next-hop "{{ datos.wan|first_valid_ip }}" admin-state enable }
                                ##
                                {% endif %}
 

                                {% if datos.wan|mask != '31' %}
                                /configure router "Base" static-routes route {{ lan_ip }} route-type unicast { }
                                /configure { router "Base" static-routes route {{ lan_ip }} route-type unicast  tag 4100 }
                                /configure router "Base" static-routes route {{ lan_ip }} route-type unicast { next-hop "{{ datos.wan|second_valid_ip }}" }
                                /configure router "Base" static-routes route {{ lan_ip }} route-type unicast { next-hop "{{ datos.wan|second_valid_ip }}" admin-state enable }
                                ##
                                {% endif %}

                                {% endfor %}

                                {% for lanv6_ip in lanv6_ips %}
                                    {% if datos.wanv6|maskv6 == '127' %}/configure router static-route-entry {{ lanv6_ip }} next-hop  {{ datos.wanv6|first_valid_ipv6 }} no shutdown {% endif %}
                                    {% if datos.wanv6|maskv6 != '127' %}/configure router static-route-entry {{ lanv6_ip }} next-hop  {{ datos.wanv6|second_valid_ipv6 }} shutdown {% endif %}
                                {% endfor %}

                            {% endif %} 

                            {% if datos.wan|mask == '31' %}admin display-config | match {{ datos.wan|first_valid_ip }} context all{% endif %}
                            {% if datos.wan|mask != '31' %}admin display-config | match {{ datos.wan|second_valid_ip }} context all{% endif %}

                            {% if datos.wanv6|maskv6 == '127' %}admin display-config | match {{ datos.wanv6|first_valid_ipv6 }} context all{% endif %}
                            {% if datos.wanv6|maskv6 != '127' %}admin display-config | match {{ datos.wanv6|second_valid_ipv6 }} context all{% endif %}

   

                        {% else %}
                                ###No se cumple ninguna condición para BGP.
                        {% endif %}



                    </textarea>
                    <div class="button-container">
                        <button class="datos-button" onclick="copyToClipboard('BgpTextArea')" aria-label="Copiar Bgp">Copiar Bgp</button>
                        <button class="datos-button" onclick="generateBgpTxt('BgpTextArea')" aria-label="Generar BGP">Generar BGP</button>


                    </div>
                </div>
                <div class="copy-box">
                    <div class="title">VRF</div>
                    <textarea id="VRFTextArea" class="datos-textarea" readonly>

                        {% if datos.tipo_configuracion == "Modificacion" and datos.tipo_servicio == "VPLS" %}
                            PE {{ datos.pe }}
                            set interfaces {{ datos.interface_pe }} unit {{ datos.unit }} description "CUSTOMER:{{ datos.cliente }}(CFS:{{ datos.cfs }})(RFS:{{ datos.rfs_ip_port }})"

                            {% if datos.pe_b %} #####{% endif %}

                            PE {{ datos.pe_b }}
                            set interfaces {{ datos.interface_pe_b }} unit {{ datos.unit_b }} description "CUSTOMER:{{ datos.cliente }}(CFS:{{ datos.cfs }})(RFS:{{ datos.rfs_ip_port_b }})"

                            
                        
                        {% elif datos.tipo_configuracion == "Alta" and datos.tipo_servicio == "VPLS" and datos.tipo_equipo == "JUNIPER" %}
                            PE {{ datos.pe }}

                            set routing-instances {{ datos.vrf }} interface {{ datos.interface_pe }}.{{ datos.unit }}
                            set routing-instances {{ datos.vrf }} instance-type vpls
                            set routing-instances {{ datos.vrf }} protocols vpls interface-mac-limit 150
                            set routing-instances {{ datos.vrf }} protocols vpls no-mac-learning
                            set routing-instances {{ datos.vrf }} protocols vpls no-tunnel-services
                            set routing-instances {{ datos.vrf }} protocols vpls vpls-id {{ datos.cfs }}
                            set routing-instances {{ datos.vrf }}  protocols vpls mtu 9000
                            set routing-instances {{ datos.vrf }} protocols vpls neighbor

                            {% if datos.pe_b %} #####{% endif %}

                            PE {{ datos.pe_b }}

                            set routing-instances {{ datos.vrf }} interface {{ datos.interface_pe_b }}.{{ datos.unit_b }}
                            set routing-instances {{ datos.vrf }} instance-type vpls
                            set routing-instances {{ datos.vrf }} protocols vpls interface-mac-limit 150
                            set routing-instances {{ datos.vrf }} protocols vpls no-mac-learning
                            set routing-instances {{ datos.vrf }} protocols vpls no-tunnel-services
                            set routing-instances {{ datos.vrf }} protocols vpls vpls-id {{ datos.cfs }}
                            set routing-instances {{ datos.vrf }}  protocols vpls mtu 9000
                            set routing-instances {{ datos.vrf }} protocols vpls neighbor

                            
                        
                            {% elif datos.tipo_configuracion == "Ampliacion" and datos.tipo_servicio == "VPN" %}

                            set class-of-service traffic-control-profiles {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o scheduler-map GX-CUST-SCHEDULER-MAP-6Q
                            set class-of-service traffic-control-profiles {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o shaping-rate {{ shaping_rate }}
                            set class-of-service traffic-control-profiles {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o delay-buffer-rate {{delay_buffer_rate}}
                            set class-of-service interfaces {{ datos.interface_pe }} unit {{ datos.unit }} output-traffic-control-profile {{ datos.interface_pe }}.{{ datos.unit }}-{{ BWx1024 }}-o

                            set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in if-exceeding bandwidth-limit {{ shaping_rate }}
                            set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in if-exceeding burst-size-limit {{burst_size_limit}}
                            set firewall policer {{ datos.interface_pe }}.{{ datos.unit }}-in then discard

                            
                        
                        {% elif datos.tipo_configuracion == "Alta" and datos.tipo_servicio == "VPN" and datos.tipo_equipo == "JUNIPER" %}

                            show  routing-instances {{ datos.vrf }}  | display set | no

                            {% if "-1-" in datos.vrf|strip %}

                            set policy-options policy-statement {{ datos.vrf }}-export term DEFAULT then default-action reject
                            set policy-options policy-statement {{ datos.vrf }}-export term L3VPN then community add {{ datos.vrf }}-mesh
                            set policy-options policy-statement {{ datos.vrf }}-export term L3VPN then default-action accept
                            set policy-options policy-statement {{ datos.vrf }}-import term L3VPN from community {{ datos.vrf }}-mesh
                            set policy-options policy-statement {{ datos.vrf }}-import term L3VPN then accept
                            set policy-options policy-statement {{ datos.vrf }}-import term final then reject
                            set policy-options community {{ datos.vrf }}-mesh members target:{{ datos.rd }}
                            set routing-instances {{ datos.vrf }} instance-type vrf
                            set routing-instances {{ datos.vrf }} interface {{ datos.interface_pe }}.{{ datos.unit }}
                            set routing-instances {{ datos.vrf }} route-distinguisher "LB_PE:Nuemeros iniciales de VRF AZUL"
                            set routing-instances {{ datos.vrf }} vrf-import VPN-import
                            set routing-instances {{ datos.vrf }} vrf-import {{ datos.vrf }}-import
                            set routing-instances {{ datos.vrf }} vrf-export VPN-export
                            set routing-instances {{ datos.vrf }} vrf-export {{ datos.vrf }}-export
                            set routing-instances {{ datos.vrf }} vrf-table-label
                            set routing-instances {{ datos.vrf }} routing-options router-id {{ datos.wan|first_valid_ip }}
                            set routing-instances {{ datos.vrf }} routing-options auto-export


                            {% else %}



                            set routing-instances {{ datos.vrf }} description "{{datos.cliente}}"
                            set routing-instances {{ datos.vrf }} instance-type vrf
                            set routing-instances {{ datos.vrf }} interface {{ datos.interface_pe }}.{{ datos.unit }}
                            set routing-instances {{ datos.vrf }} route-distinguisher {{ datos.rd }}
                            set routing-instances {{ datos.vrf }} vrf-import {{ datos.vrf }}-import
                            set routing-instances {{ datos.vrf }} vrf-export {{ datos.vrf }}-export
                            set routing-instances {{ datos.vrf }} vrf-table-label
                            set routing-instances {{ datos.vrf }} routing-options maximum-prefixes 5000
                            set routing-instances {{ datos.vrf }} routing-options maximum-prefixes threshold 95
                            set routing-instances {{ datos.vrf }} routing-options maximum-prefixes threshold 95
                            set routing-instances {{ datos.vrf }} routing-options router-id {{ datos.wan|first_valid_ip }}
                            set routing-instances {{ datos.vrf }} routing-options auto-export
                            set policy-options policy-statement {{ datos.vrf }}-export term MON-MNG-Policy from protocol static
                            set policy-options policy-statement {{ datos.vrf }}-export term MON-MNG-Policy from policy MON-MNG
                            set policy-options policy-statement {{ datos.vrf }}-export term MON-MNG-Policy then accept
                            set policy-options policy-statement {{ datos.vrf }}-export term bgp-static-direct-export-RT from protocol bgp
                            set policy-options policy-statement {{ datos.vrf }}-export term bgp-static-direct-export-RT from protocol static
                            set policy-options policy-statement {{ datos.vrf }}-export term bgp-static-direct-export-RT from protocol direct
                            set policy-options policy-statement {{ datos.vrf }}-export term bgp-static-direct-export-RT then community add RT-{{ datos.vrf }}_export
                            set policy-options policy-statement {{ datos.vrf }}-export term bgp-static-direct-export-RT then accept
                            set policy-options policy-statement {{ datos.vrf }}-export term reject-all then reject
                            set policy-options policy-statement {{ datos.vrf }}-import term import from community RT-{{ datos.vrf }}_import
                            set policy-options policy-statement {{ datos.vrf }}-import term import from community RT-gestion_col
                            set policy-options policy-statement {{ datos.vrf }}-import term import then accept
                            set policy-options policy-statement {{ datos.vrf }}-import term reject-all then reject
                            set policy-options community RT-{{ datos.vrf }}_export members target:{{ datos.rd }}
                            set policy-options community RT-{{ datos.vrf }}_import members target:{{ datos.rd }}

                            {% endif %}

                        
                        {% else %}
                                ##### No se cumple ninguna condición para VRF.
                        {% endif %}

                    </textarea>
                    <div class="button-container">
                        <button class="datos-button" onclick="copyToClipboard('VRFTextArea')" aria-label="Copiar VRF">Copiar VRF</button>
                        <button class="datos-button" onclick="generateVrfTxt('VRFTextArea')" aria-label="Generar VRF">Generar VRF</button>
                    </div>
                    <script>
                        <script>
                            function copyToClipboard(elementId) {
                                var copyText = document.getElementById(elementId);
                                copyText.select();
                                document.execCommand("copy");
                            }
                            
                            function generateTxt(elementId) {
                                var text = document.getElementById(elementId).value;
                                var trimmedText = text.split('\n').map(line => line.trimStart()).join('\n');
                                var blob = new Blob([trimmedText], { type: "text/plain;charset=utf-8" });
                                var link = document.createElement("a");
                                link.href = URL.createObjectURL(blob);
                                link.download = elementId + ".txt";
                                link.click();
                            }
                            
                            function generatePolicerTxt(elementId) {
                                var text = document.getElementById(elementId).value;
                                var trimmedText = text.split('\n').map(line => line.trimStart()).join('\n');
                                var blob = new Blob([trimmedText], { type: "text/plain;charset=utf-8" });
                                var link = document.createElement("a");
                                link.href = URL.createObjectURL(blob);
                                link.download = elementId + "_policer.txt";
                                link.click();
                            }
                            
                            function generateBgpTxt(elementId) {
                                var text = document.getElementById(elementId).value;
                                var trimmedText = text.split('\n').map(line => line.trimStart()).join('\n');
                                var blob = new Blob([trimmedText], { type: "text/plain;charset=utf-8" });
                                var link = document.createElement("a");
                                link.href = URL.createObjectURL(blob);
                                link.download = elementId + "_bgp.txt";
                                link.click();
                            }
                            
                            function generateVrfTxt(elementId) {
                                var text = document.getElementById(elementId).value;
                                // Eliminar espacios al inicio de cada línea
                                var trimmedText = text.split('\n').map(line => line.trimStart()).join('\n');
                                var blob = new Blob([trimmedText], { type: "text/plain;charset=utf-8" });
                                var link = document.createElement("a");
                                link.href = URL.createObjectURL(blob);
                                link.download = elementId + "_vrf.txt";
                                link.click();
                            }
                            
                            function generateAllTxt() {
                                var textareas = document.querySelectorAll('.datos-textarea');
                                var allText = '';
                                textareas.forEach(function(textarea) {
                                    var trimmedText = textarea.value.split('\n').map(line => line.trimStart()).join('\n');
                                    allText += trimmedText + '\n';
                                });
                                var blob = new Blob([allText], { type: "text/plain;charset=utf-8" });
                                var link = document.createElement("a");
                                link.href = URL.createObjectURL(blob);
                                link.download = "all_textareas.txt";
                                link.click();
                            }
                            </script>
                            
                    </div>
                </div>
                <div class="button-container">
                    <button class="datos-button" onclick="window.location.href='{% url 'datos' %}'" aria-label="Regresar">Regresar</button>
                </div>
            </main>
        </div>
        
        JavaScript

        <script>
            function copyToClipboard(elementId) {
                var copyText = document.getElementById(elementId);
                copyText.select();
                document.execCommand("copy");
            }
            
            function generateTxt(elementId) {
                var text = document.getElementById(elementId).value;
                // Eliminar espacios al inicio de cada línea
                var trimmedText = text.split('\n').map(line => line.trimStart()).join('\n');
                // Eliminar todos los saltos de línea en blanco
                var cleanedText = trimmedText.replace(/(\n\s*\n)+/g, '\n');
                var blob = new Blob([cleanedText], { type: "text/plain;charset=utf-8" });
                var link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = elementId + ".txt";
                link.click();
            }
            
            function generatePolicerTxt(elementId) {
                var text = document.getElementById(elementId).value;
                // Eliminar espacios al inicio de cada línea
                var trimmedText = text.split('\n').map(line => line.trimStart()).join('\n');
                // Eliminar todos los saltos de línea en blanco
                var cleanedText = trimmedText.replace(/(\n\s*\n)+/g, '\n');
                var blob = new Blob([cleanedText], { type: "text/plain;charset=utf-8" });
                var link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = elementId + "_policer.txt";
                link.click();
            }
            
            function generateBgpTxt(elementId) {
                var text = document.getElementById(elementId).value;
                // Eliminar espacios al inicio de cada línea
                var trimmedText = text.split('\n').map(line => line.trimStart()).join('\n');
                // Eliminar todos los saltos de línea en blanco
                var cleanedText = trimmedText.replace(/(\n\s*\n)+/g, '\n');
                var blob = new Blob([cleanedText], { type: "text/plain;charset=utf-8" });
                var link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = elementId + "_bgp.txt";
                link.click();
            }
            
            function generateVrfTxt(elementId) {
                var text = document.getElementById(elementId).value;
                // Eliminar espacios al inicio de cada línea
                var trimmedText = text.split('\n').map(line => line.trimStart()).join('\n');
                // Eliminar todos los saltos de línea en blanco
                var cleanedText = trimmedText.replace(/(\n\s*\n)+/g, '\n');
                var blob = new Blob([cleanedText], { type: "text/plain;charset=utf-8" });
                var link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = elementId + "_vrf.txt";
                link.click();
            }
            
            function generateAllTxt() {
                var textareas = document.querySelectorAll('.datos-textarea');
                var allText = '';
                textareas.forEach(function(textarea) {
                    // Eliminar espacios al inicio de cada línea
                    var trimmedText = textarea.value.split('\n').map(line => line.trimStart()).join('\n');
                    // Eliminar todos los saltos de línea en blanco
                    var cleanedText = trimmedText.replace(/(\n\s*\n)+/g, '\n');
                    allText += cleanedText + '\n';
                });
                var blob = new Blob([allText], { type: "text/plain;charset=utf-8" });
                var link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = "all_textareas.txt";
                link.click();
            }
            </script>
            
    </body>
</html>
